<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teltonika config</title>
</head>
<body>
    <div id="parent">
        <div id="form-parent">
            <form id="form">
                <div>
                    <input name="name" type="text" placeholder="name">
                </div>
                <div>
                    <input name="fatherName" type="text" placeholder="father's name">
                </div>
                <div>
                    <input name="age" type="number" placeholder="age">
                </div>
                <div>
                    <input name="country" type="text" placeholder="country">
                </div>
                <div>
                    <input name="profession" type="text" placeholder="profession">
                </div>
            </form>
            <div>
                <button onclick="sendData()">Send data</button>
            </div>
            <div>
                <button onclick="retrieveData()">Retrieve Data</button>
            </div>
        </div>
    </div>
</body>
<script>
    let webSS = new WebSocket('ws://127.0.0.1:8080');
    webSS.onopen = ()=>{
        console.log("connected to websocket server");
    }
    webSS.close = ()=>{
        console.log("connection to websocket server is closed");
    }
    webSS.onerror = (ev)=>{
        console.log(ev);
    }
   
    
    function sendData(){
        let inputElements = document.getElementsByTagName('input');
        let outputData = '{'
        let length = inputElements.length;
        for(let i=0; i< length; i++){
            let key = inputElements[i].name;
            let value = inputElements[i].value;
            outputData+= `"${key}"`+":"+`"${value}"`;
            if(i===inputElements.length-1){
                outputData+="}";
            }else{
                outputData+=",";
            }
        }
        console.log(outputData);
        webSS.send(outputData);
    }
    function retrieveData(){
        webSS.send("send");
        webSS.onmessage = (msgEvent)=>{
        // console.log(msgEvent.data);
        if(msgEvent.data == 'OK'){
            alert("data saved in config file");
        }else{
            let jsonFiledata= JSON.parse(msgEvent.data);
            console.log( jsonFiledata);
            let inputElements = document.getElementsByTagName('input');
            let length = inputElements.length;
            for(let i=0; i< length;i++){
                let key = inputElements[i].name;
                if(new Object(jsonFiledata).hasOwnProperty(key)){
                    inputElements[i].value = new Object(jsonFiledata)[key]
                    // console.log(key);
                }
            }
        }
    }
    }
    
</script>
</html>